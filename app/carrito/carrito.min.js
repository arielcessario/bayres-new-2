(function(){angular.module("bayres.carrito",[]).config(["$routeProvider",function(b){b.when("/carrito",{templateUrl:"carrito/carrito.html",controller:"CarritoController",data:{requiresLogin:true}})}]).controller("CarritoController",a);a.$inject=["$scope","AcUtils","UserService","CartVars","CartService","$location","LinksService","BayresService","UserVars","SucursalService","BayresMailerService"];function a(p,h,j,k,q,i,o,m,b,n,l){var g=this;g.message="";g.carritoDetalles=[];g.sucursales=[];g.tipoEnvios=[{id:1,name:"Envio a"},{id:2,name:"Retira por"}];g.lugarDeEnvios=[{id:1,name:"Gran Buenos Aires"},{id:2,name:"Capital Federal"},{id:3,name:"Interior del Pais"}];g.carritoInfo={cantidadDeProductos:0,totalAPagar:0,modified:false};g.tipoEnvioDefecto=g.tipoEnvios[0];g.lugarDeEnvioDefecto=g.lugarDeEnvios[0];g.removeProducto=d;g.refreshProducto=e;g.confirmCarrito=c;g.carritoDetalles=(k.carrito.length>0)?k.carrito:m.carrito;g.carritoInfo.cantidadDeProductos=(k.carrito.length>0)?k.carrito_cantidad_productos():m.carrito_cantidad_productos();g.carritoInfo.totalAPagar=(k.carrito.length>0)?k.carrito_total():m.carrito_total();n.get(function(r){g.sucursales=r;g.sucursal=r[0]});k.listen(function(){g.carritoInfo.cantidadDeProductos=(k.carrito.length>0)?k.carrito_cantidad_productos():m.carrito_cantidad_productos();g.carritoInfo.totalAPagar=(k.carrito.length>0)?k.carrito_total():m.carrito_total()});function d(t){var r=(k.carrito.length>0)?k.carrito[t]:m.carrito[t];var u=r.nombre+" $"+r.precio_unitario+"(x"+r.cantidad+")";var v=confirm("Â¿Desea borrar el producto "+u+"?");if(v){var s=[];s.push(r.carrito_detalle_id);q.removeFromCart(s,function(w){if(w!=-1){m.miCarrito.total=k.carrito_total();q.update(m.miCarrito,function(x){if(x){m.messageConfirm="Se quito el producto"}else{m.messageConfirm="Error borrando el producto"}m.showMessageConfirm=true});f()}else{m.messageConfirm="Error borrando el producto";m.showMessageConfirm=true}})}else{return}}function f(){g.carritoInfo.cantidadDeProductos=(k.carrito.length>0)?k.carrito_cantidad_productos():m.carrito_cantidad_productos();g.carritoInfo.totalAPagar=(k.carrito.length>0)?k.carrito_total():m.carrito_total();k.broadcast()}function e(r){var s={producto_id:r.producto_id,cantidad:r.cantidad,en_oferta:r.en_oferta,precio_unitario:r.precio_unitario,carrito_id:r.carrito_id,nombre:r.nombre,carrito_detalle_id:r.carrito_detalle_id};q.updateProductInCart(s,function(t){if(t){m.miCarrito.total=k.carrito_total();q.update(m.miCarrito,function(u){if(u){console.log("Update Ok")}else{console.log("Update Error")}});f()}})}function c(){if(k.carrito.length>0){m.miCarrito.total=k.carrito_total();m.miCarrito.status=1;m.miCarrito.origen=g.tipoEnvioDefecto.id;m.miCarrito.destino=(g.tipoEnvioDefecto.id==1)?g.lugarDeEnvioDefecto.id:g.sucursal.sucursal_id;q.update(m.miCarrito,function(s){if(s){m.miCarrito.productos=k.carrito;var r={carrito:m.miCarrito,sucursal:"Sucursal Once"};b.clearCache=true;j.getById(j.getFromToken().data.id,function(t){if(t!=-1){r.direccion=t.direcciones[0].calle+" "+t.direcciones[0].nro;r.cliente=m.usuario.nombre+" "+m.usuario.apellido;r.mail=t.mail;r.tipoEnvio=g.tipoEnvioDefecto.name;r.lugarDeEnvio=(g.tipoEnvioDefecto.id==1)?g.lugarDeEnvioDefecto.name:g.sucursal.nombre;l.sendMailConfirmarCarrito(r,function(u){if(u){m.messageConfirm="Su pedido fue enviado"}else{m.messageConfirm="Error confirmando el carrito"}m.showMessageConfirm=true})}});m.tieneCarrito=false;m.miCarrito={};k.carrito=[];i.path("/main");o.selectedIncludeTop="main/ofertas.html"}else{m.messageConfirm="Error confirmando el carrito";m.showMessageConfirm=true}})}else{g.message="El Carrito esta vacio. Por favor agregue productos";m.messageConfirm="El Carrito esta vacio. Por favor agregue productos";m.showMessageConfirm=true}}}})();