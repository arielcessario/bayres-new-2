(function(){angular.module("bayres.usuarios",[]).config(["$routeProvider",function(b){b.when("/usuarios",{templateUrl:"usuarios/usuario.html",controller:"UsuarioController",data:{requiresLogin:false}})}]).controller("UsuarioController",a);a.$inject=["$scope","$location","UserService","AcUtils","LinksService","CartVars","BayresService","CartService"];function a(o,g,h,c,n,i,j,p){var b=this;b.userForm={nombre:"",apellido:"",mail:"",nacionalidad_id:0,tipo_doc:0,nro_doc:"",comentarios:"",marcado:"",telefono:"",fecha_nacimiento:"",profesion_id:0,saldo:"",rol_id:3,news_letter:0,password:"",calle:"",nro:""};b.dirForm={usuario_id:0,calle:"",nro:0,piso:0,puerta:"",ciudad_id:0};b.repeatMail="";b.message="";b.showError=false;b.login=k;b.create=f;function l(){if(b.userForm.nombre.trim().length>0&&b.userForm.apellido.trim().length>0&&b.userForm.fecha_nacimiento.trim().length>0&&b.userForm.telefono.trim().length>0&&b.userForm.mail.trim().length>0&&b.userForm.password.trim().length>0&&b.repeatMail.trim().length>0&&b.userForm.calle.trim().length>0&&b.userForm.nro.trim().length>0){return true}return false}function k(){g.path("/login");n.selectedIncludeTop="login/login.html";i.broadcast()}function f(){if(l()){if(c.validateEmail(b.userForm.mail.trim())&&c.validateEmail(b.repeatMail.trim())){if(b.userForm.mail.trim()===b.repeatMail.trim()){h.userExist(b.userForm.mail,function(q){if(q==-1){h.create(b.userForm,function(r){console.log(r);if(r!=-1){h.login(b.userForm.mail.trim(),b.userForm.password.trim(),1,function(t){if(t!=-1){j.usuario={id:t.user.usuario_id,nombre:t.user.nombre,apellido:t.user.apellido,mail:t.user.mail,rol:t.user.rol_id};j.isLogged=true;if(j.carrito.length>0){var s={usuario_id:j.usuario.id,total:j.carrito_total(),status:0};p.create(s,function(u){if(u!=-1){j.tieneCarrito=true;j.miCarrito=u;p.addToCart(u.carrito_id,j.carrito,function(x){if(x!=-1){for(var w=0;w<j.carrito.length;w++){for(var v=0;v<i.carrito.length;v++){if(i.carrito[v].producto_id==j.carrito[w].producto_id){if(i.carrito[v].nombre===undefined){i.carrito[v].nombre=j.carrito[w].nombre}}}}b.showError=false;j.carrito=[]}})}})}g.path("/main");n.selectedIncludeTop="main/ofertas.html"}})}else{b.showError=true;b.message="Error creando el usuario";b.error_code=1}})}else{b.showError=true;b.message="El mail ingresado ya existe. Por favor ingrese otro mail";b.error_code=6}})}else{b.showError=true;b.message="Los mails deben ser iguales";b.error_code=6}}else{b.showError=true;b.message="El mail ingresado no tiene un formato valido";b.error_code=6}}else{d()}}function d(){b.showError=true;if(b.userForm.nombre.trim().length==0){b.message="El Nombre es Obligatorio";b.error_code=1;return}if(b.userForm.apellido.trim().length==0){b.message="El Apellido es Obligatorio";b.error_code=2;return}if(b.userForm.fecha_nacimiento.trim().length==0){b.message="La Fecha de Nacimiento es Obligatoria";b.error_code=3;return}if(!m(b.userForm.fecha_nacimiento)){b.message="La Fecha de Nacimiento no tiene el formato correcto dd/mm/aaaa";b.error_code=3;return}if(b.userForm.telefono.trim().length==0){b.message="El Tel�fono es Obligatorio";b.error_code=4;return}if(!e(b.userForm.telefono.trim())){b.message="El Tel�fono no tiene un formato valido";b.error_code=4;return}if(b.userForm.calle.trim().length==0||b.userForm.nro.trim().length==0){b.message="La direcci�n y el numero son Obligatorias";b.error_code=5;return}if(b.userForm.mail==undefined){b.message="El Mail es Obligatorio";b.error_code=6;return}if(b.userForm.mail.trim().length==0){b.message="El Mail es Obligatorio";b.error_code=6;return}if(b.repeatMail==undefined){b.message="El Mail es Obligatorio";b.error_code=6;return}if(b.repeatMail.trim().length==0){b.message="Debe Repetir el mismo mail";b.error_code=7;return}if(b.userForm.password.trim().length==0){b.message="La Contrase�a es Obligatoria";b.error_code=8;return}if(!c.validateEmail(b.userForm.mail.trim())){b.message="El mail ingresado no es valido";b.error_code=6;return}if(!c.validateEmail(b.repeatMail.trim())){b.message="El segundo mail ingresado no es valido";b.error_code=7;return}}function e(q){var r=/^[(]{0,1}[0-9]{3}[)]{0,1}[-\s\.]{0,1}[0-9]{3}[-\s\.]{0,1}[0-9]{4}$/;if(q.match(r)){return true}else{return false}}function m(q){var r=/^\d{1,2}\/\d{1,2}\/\d{2,4}$/;if((q.match(r))&&(q!="")){return true}else{return false}}}})();